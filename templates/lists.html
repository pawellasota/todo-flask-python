{% extends "base.html" %}

{% block navbar %}
    {{ super() }}
    <a class="btn btn-default button-max-width" href="{{ url_for("list_todo_lists") }}" role="button">List of lists</a>
    <a class="btn btn-default button-max-width" href="{{ url_for("add_list") }}" role="button">Add new list</a>
{% endblock %}
{% block content %}
    {{ super() }}
    <h2 class="content">Your Todo lists</h2>
            {% for list in lists %}
                <a class="btn btn-default btn-large" id="list_{{ list.todo_list_id }}" href="" role="button">{{ list.todo_list_name }}</a>
            {% endfor %}

    <div id="l_content" class="row" style="padding: 50px; display: none;"></div>
    <div id="e_content" class="row" style="padding: 50px; display: none;"></div>

{% endblock %}
{% block scripts %}
{{ super() }}

<script>

$(document).ready(function() {
    $('[id^=list_]').on('click', function (event) {
        var list_id = $(this).attr('id');
        event.preventDefault();
        $('div#l_content').slideUp("slow", function () {
            $.ajax({
                data : { list_id: list_id },
                type : 'GET',
                url : '/get_todo_items',
                success : function (data) {
                    if (data) {
                        $('div#e_content').slideUp("slow");
                        $('div#l_content').slideDown("slow");
                        $('div#l_content').html(data)
                    }
                },
                error : function () {
                    $('div#l_content').innerHTML="Failed to load data"
                }

            });
        });
    });
    $(document).on('change', '[class^=todo_]', function (event) {
        var todo_id = $(this).attr('class');
        $.ajax({
            data : { todo_id: todo_id},
            type : 'GET',
            url : '/toggle',
            success: function (data) {
                if (data == "True") {
                    $('#checked_status').text("Todo item saved as marked").show();
                }
                else {
                    $('#checked_status').text("Todo item saved as unmarked").show();
                }
                $('#checked_status').delay(2000).fadeOut('slow');
            },
            error : function () {
                alert("Toggle error")
            }
        });
    });
    $(document).on('click', '[id^=remove_]', function (event) {
        event.preventDefault();
        var todo_id = $(this).attr('id');
        $.ajax({
            data : { todo_id : todo_id},
            type : 'GET',
            context: this,
            url : '/remove',
            success : function (data) {
                $('#checked_status').text("Todo removed: ", data).show();
                $('#checked_status').delay(2000).fadeOut('slow');
                $(this).closest('tr').fadeOut("slow");
            },
            error : function () {
                alert("Remove error")
            }
        })
    });
    $(document).on('click', '[id^=edit_]', function (event) {
        event.preventDefault();
        var todo_id = $(this).attr('id');
        $('div#l_content').slideUp("slow");
        $('div#e_content').slideDown("slow", function () {
            $.ajax({
                data : { todo_id : todo_id},
                type : 'GET',
                url : '/edit',
                success : function (data) {
                    $('div#e_content').slideDown("slow");
                    $('div#e_content').html(data);
                },
                error : function () {
                    alert("Cannot add todo item!")
                }
            })
        })
    })
    $(document).on('click', '[id^=update_todo_]', function (event) {
        event.preventDefault();
        var todo_id = $(this).attr('id');
        var todo_name = $('#todo_name').val();
        var todo_due_date = $('#todo_due_date').val();
        var todo_priority = $('#todo_priority').val();
        $.ajax({
            data : { todo_id : todo_id,
                     todo_name : todo_name,
                     todo_due_date : todo_due_date,
                     todo_priority : todo_priority },
            type : 'POST',
            url : '/edit',
            success : function (data) {
                $('#update_status').text("Todo updated: ", data).show();
                $('#update_status').delay(2000).fadeOut('slow');
                $('div#e_content').delay(2000).slideUp("slow");
            },
            error: function (data) {
                alert(data)
            }
        })
    })
});
</script>
{% endblock %}